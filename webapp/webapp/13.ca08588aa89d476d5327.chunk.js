webpackJsonp([13],{316:function(e,r,t){"use strict";function i(e){c||t(688)}Object.defineProperty(r,"__esModule",{value:!0});var n=t(572),o=t.n(n);for(var a in n)"default"!==a&&function(e){t.d(r,e,function(){return n[e]})}(a);var s=t(690),l=t.n(s),c=!1,d=t(0),f=i,u=d(o.a,l.a,!1,f,"data-v-0e2fe568",null);u.options.__file="src/views/system/Role.vue",r.default=u.exports},572:function(e,r,t){"use strict";function i(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}Object.defineProperty(r,"__esModule",{value:!0});var n=t(25),o=t(11);r.default={data:function(){var e=this;return{pageNum:null,currentPageIdx:1,permissionWrapper:!1,ifLoading:!0,deleteRoleArr:[],delRole:!1,deleteRoleID:null,fixedRolePermission:[],submitArr:[],allPermission:[],roleId:null,showAddRole:!1,showForm:!1,formValidate:{name:null,roleDscrp:null},ruleValidate:{name:[{required:!0,message:"角色名称不能为空!",trigger:"blur"}]},column_frist:[{title:"ID",key:"id",width:80},{title:"角色名称",key:"role"},{title:"备注",key:"description"},{title:"操作",render:function(r,t){return r("div",[r("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.showForm=!0,e.filterPermission=[],e.roleId=t.row.id,e.formValidate.name=t.row.role,e.formValidate.roleDscrp=t.row.description;var r=JSON.parse((0,o.getStore)("allPermission"));r.forEach(function(e){e.checked=!1}),(0,n.queryRolePermission)({roleId:t.row.id}).then(function(t){if(t.code)e.$Message.error("数据获取异常！");else{var i=[];t.data.forEach(function(e){e.subMenu.forEach(function(e){i.push({id:e.id,parentId:e.parentId})})}),r.forEach(function(e){e.children.forEach(function(e){i.find(function(r){return r.id===e.id})&&(e.checked=!0)})}),e.permissions=r}})}}},"修改"),r("Button",{props:{type:"error",size:"small"},on:{click:function(){e.deleteRoleID=t.row.id,e.delRoleBtn()}}},"删除")])}}],permissions:[],userpage:[]}},methods:{changePage:function(e){this.currentPageIdx=e,this.refreshPage({pageNo:e,pageSize:10})},deleteRole:function(){var e=this;(0,n.deleteRole)({id:this.deleteRoleID}).then(function(r){r.code?e.$Message.error(r.message):(e.$Message.success("删除成功！"),e.refreshPage())})},delRoleBtn:function(){this.delRole=!0},addRoleBtn:function(){var e=this;this.submitArr=[],this.formValidate.roleDscrp=this.formValidate.name=null,this.showAddRole=!0,this.allPermission=JSON.parse((0,o.getStore)("allPermission")),this.allPermission.forEach(function(r,t){e.submitArr.push(r.id),void 0!==r.children&&r.children.forEach(function(r){e.submitArr.push(r.id)})})},addRoleTree:function(e){var r=this,t=[];this.submitArr=[],e.forEach(function(e){r.allPermission.forEach(function(r,i){r.children.forEach(function(i){i.id===e.id&&t.push(r.id)})})});var n=[].concat(i(new Set(t))),o=[];e.forEach(function(e){e.children||o.push(e.id)}),this.submitArr=[].concat(i(n),o)},addRole:function(){var e=this;if(-1===this.submitArr.indexOf(8)){var r;(r=this.submitArr).push.apply(r,[8,11,12,13,66,90,116])}if(""!==this.formValidate.name&&this.formValidate.name){this.permissionWrapper=!0;var t={role:this.formValidate.name,description:this.formValidate.roleDscrp,permissions:this.submitArr};(0,n.addAuditRole)(t).then(function(r){r.code?e.$Message.error(r.message):(e.$Message.success("操作成功！"),e.refreshPage()),e.permissionWrapper=!1}).catch(function(e){})}else this.$Message.warning("角色名称不能为空！")},selectArrayFn:function(e){var r=[];e.forEach(function(e){e.children&&r.push(e)});var t=[];return r.forEach(function(e){t.push(e.id),e.children.forEach(function(e){t.push(e.id)})}),t},fixTreeArray:function(e){var r=[];e.forEach(function(e){r.push(e.id),r.push(e.parentId)}),this.fixedRolePermission=[].concat(i(new Set(r)))},confirmChange:function(){var e=this;if(this.permissionWrapper=!0,-1===this.fixedRolePermission.indexOf(8)){var r;(r=this.fixedRolePermission).push.apply(r,[8,11,12,13,66,90,116])}var t={id:this.roleId,role:this.formValidate.name,description:this.formValidate.roleDscrp,permissions:this.fixedRolePermission};(0,n.addAuditRole)(t).then(function(r){r.code?e.$Message.error("角色权限修改失败！"):(e.$Message.success("角色权限修改成功！"),e.refreshPage()),e.permissionWrapper=!1})},cancelChange:function(){this.$Message.info("已取消修改！")},getAllPermissionFn:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=[];(0,n.getAllPermission)().then(function(t){t.code||t.data.forEach(function(t){var i={title:t.title,id:t.id,checked:e,children:[]};t.subMenu.forEach(function(e){var r={id:e.id,title:e.title,parentId:e.parentId};i.children.push(r)}),r.push(i),(0,o.removeStore)("allPermission"),(0,o.setStore)("allPermission",r)})})},refreshPageManual:function(){this.refreshPage()},refreshPage:function(){var e=this;this.ifLoading=!0,(0,n.roleManage)().then(function(r){r.code?e.$Message.error(r.message):(e.userpage=r.data.content,e.ifLoading=!1)},function(e){})}},created:function(){this.getAllPermissionFn(),this.refreshPage()},filters:{filterPer:function(e){return e.forEach(function(e){e.children.length>0&&e.children.forEach(function(e){116!==e.id&&90!==e.id||(e.disableCheckbox=!0,e.checked=!0)})}),e}}}},688:function(e,r,t){var i=t(689);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);t(7)("4e43bc7a",i,!1,{})},689:function(e,r,t){r=e.exports=t(6)(!1),r.push([e.i,"\n.permissionWrapper[data-v-0e2fe568] {\n  position: absolute;\n  z-index: 10;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.2);\n}\n.permissionWrapper p[data-v-0e2fe568] {\n  position: absolute;\n  top: 50%;\n  left: 45%;\n  transform: -50%;\n  font-size: 25px;\n  font-style: '\\9ED1\\4F53';\n  text-align: center;\n  color: #fff;\n}\n",""])},690:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",[t("Card",[t("p",{attrs:{slot:"title"},slot:"title"},[e._v("\n        角色管理\n          "),t("Button",{attrs:{type:"primary",size:"small"},on:{click:e.refreshPageManual}},[t("Icon",{attrs:{type:"refresh"}}),e._v("\n            刷新\n          ")],1)],1),e._v(" "),t("Row",{staticClass:"functionWrapper"},[t("div",{staticClass:"btnsWrapper clearfix"},[t("Button",{attrs:{type:"primary"},on:{click:e.addRoleBtn}},[e._v("添加角色")])],1)]),e._v(" "),t("Modal",{attrs:{title:"删除角色"},on:{"on-ok":e.deleteRole,"on-cancel":function(r){e.$Message.info("已取消！")}},model:{value:e.delRole,callback:function(r){e.delRole=r},expression:"delRole"}},[t("p",[e._v("是否删除该角色?")])]),e._v(" "),t("Modal",{attrs:{title:"添加角色"},on:{"on-ok":e.addRole},model:{value:e.showAddRole,callback:function(r){e.showAddRole=r},expression:"showAddRole"}},[t("Form",{attrs:{"label-position":"right",model:e.formValidate,"label-width":100,rules:e.ruleValidate}},[t("FormItem",{attrs:{label:"角色名称：",prop:"name"}},[t("Input",{model:{value:e.formValidate.name,callback:function(r){e.$set(e.formValidate,"name",r)},expression:"formValidate.name"}})],1),e._v(" "),t("FormItem",{attrs:{label:"角色描述："}},[t("Input",{attrs:{type:"textarea"},model:{value:e.formValidate.roleDscrp,callback:function(r){e.$set(e.formValidate,"roleDscrp",r)},expression:"formValidate.roleDscrp"}})],1)],1),e._v(" "),t("br"),e._v(" "),t("Tree",{attrs:{data:e.allPermission,"show-checkbox":""},on:{"on-check-change":e.addRoleTree}})],1),e._v(" "),t("Row",[t("Table",{attrs:{columns:e.column_frist,data:e.userpage,loading:e.ifLoading,border:""}})],1),e._v(" "),t("Modal",{attrs:{title:"修改权限"},on:{"on-ok":e.confirmChange,"on-cancel":e.cancelChange},model:{value:e.showForm,callback:function(r){e.showForm=r},expression:"showForm"}},[t("Form",[t("FormItem",{attrs:{label:"角色描述："}},[t("Input",{attrs:{type:"textarea"},model:{value:e.formValidate.roleDscrp,callback:function(r){e.$set(e.formValidate,"roleDscrp",r)},expression:"formValidate.roleDscrp"}})],1)],1),e._v(" "),t("Tree",{attrs:{data:e._f("filterPer")(e.permissions),"show-checkbox":""},on:{"on-check-change":e.fixTreeArray}})],1),e._v(" "),t("Row",{staticClass:"pageWrapper"},[t("Page",{staticClass:"buttomPage",attrs:{total:e.pageNum,current:e.currentPageIdx,"show-elevator":""},on:{"on-change":e.changePage}})],1)],1),e._v(" "),e.permissionWrapper?t("div",{staticClass:"permissionWrapper"},[t("p",[e._v("数据更新中...")])]):e._e()],1)},n=[];i._withStripped=!0;var o={render:i,staticRenderFns:n};r.default=o}});